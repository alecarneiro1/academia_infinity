<%- include('./partials/headPartialView') %>
<%- include('./partials/headerPartialView') %>


<main class="content">
    <!-- KPIs -->
    <section class="kpis" aria-label="Indicadores">
      <article class="card kpi">
        <h2 class="kpi__label">Mensagens</h2>
        <div class="kpi__value"><%= (kpis && kpis.total_mensages !== undefined) ? kpis.total_mensages : '0' %></div>
      </article>
      <article class="card kpi">
        <h2 class="kpi__label">Contatos</h2>
        <div class="kpi__value"><%= (kpis && kpis.total_contacts !== undefined) ? kpis.total_contacts : '0' %></div>
      </article>
      <article class="card kpi">
        <h2 class="kpi__label">Atendimentos</h2>
        <div class="kpi__value"><%= (kpis && kpis.total_summaries !== undefined) ? kpis.total_summaries : '0' %></div>
      </article>
      <article class="card kpi">
        <h2 class="kpi__label">Matrículas</h2>
        <div class="kpi__value"><%= (kpis && kpis.total_matriculas !== undefined) ? kpis.total_matriculas : '0' %></div>
      </article>
    </section>

    <!-- Gráfico (placeholder) -->
    <section class="card block" aria-label="Mensagens recebidas">
      <header class="block__head">
        <div>
          <h3 class="block__title">Mensagens recebidas</h3>
          <p class="block__subtitle">Distribuição diária, semanal, mensal e anual</p>
        </div>
        <div class="filters" role="group" aria-label="Filtros de período">
          <button class="btn btn--ghost" data-range="today">Hoje</button>
          <button class="btn btn--ghost" data-range="week">Semana</button>
          <button class="btn btn--ghost" data-range="month">Mês</button>
          <button class="btn btn--ghost" data-range="year">Ano</button>
        </div>
      </header>
      <!-- Substituir o placeholder pelo canvas -->
      <div class="chart" style="height: 400px; width: 100%; max-width: 100%;">
        <canvas id="messagesChart" height="400" style="width:100%;max-width:100%;display:block;"></canvas>
      </div>
    </section>

    <!-- Tabela -->
    <section class="card block" aria-label="Atendimentos mais recentes">
      <header class="block__head">
        <div>
          <h3 class="block__title">Atendimentos</h3>
          <p class="block__subtitle">Atendimentos mais recentes</p>
        </div>
      </header>

      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Assunto</th>
              <th>Contato</th>
              <th>Data</th>
            </tr>
          </thead>
          <tbody>
            <% if (atendimentos && atendimentos.length > 0) { %>
              <% atendimentos.forEach(a => { %>
                <tr>
                  <td>#<%= a.id %></td>
                  <td><%= a.assunto %></td>
                  <td><%= a.contato %></td>
                  <td><%= a.data ? new Date(a.data).toLocaleDateString('pt-BR') + ' ' + new Date(a.data).toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}) : '-' %></td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="4" style="text-align:center;">Nenhum atendimento encontrado</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>
</main>




  <footer class="footer">
    <p class="footer__title">Sistema Infinity v1.0 | Hands-On Comunicação</p>
  </footer>

  <!-- Botão hambúrguer (mobile) -->
  <label for="nav-toggle" class="hamburger" aria-label="Abrir menu" title="Abrir menu">
    <span></span><span></span><span></span>
  </label>

  <!-- Overlay para fechar o menu quando aberto no mobile -->
  <label for="nav-toggle" class="overlay" aria-hidden="true"></label>

  <!-- Scripts -->

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/js/admin/dashboardScripts.js"></script>

</body>
</html>

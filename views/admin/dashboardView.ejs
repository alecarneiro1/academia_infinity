<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard • Tema Dark Vermelho</title>
  <link rel="stylesheet" href="/css/admin/adminStyles.css" />
  <script src="/js/admin/adminScripts.js" defer></script>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <%- include('./partials/sidebarPartialView') %>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <%- include('./partials/topbarPartialView') %>

      <section class="container">
        <!-- Page header -->
        <div class="page-head">
          <div>
            <h1 class="h1">Visão Geral</h1>
          </div>
          <div class="actions">
            <button class="btn btn--primary">Novo Relatório</button>
            <button class="btn btn--outline">Exportar</button>
          </div>
        </div>

        <% if (typeof error !== 'undefined' && error) { %>
          <div style="color:#e11d48; font-weight:bold; margin-bottom:1rem;"><%= error %></div>
        <% } %>

        <!-- KPI cards -->
        <div class="grid grid--4">
          <article class="card kpi">
            <div class="card__head">
              <span class="muted">Mensagens</span>
            </div>
            <div class="kpi__value"><%= (kpis && typeof kpis.total_mensages !== 'undefined') ? kpis.total_mensages : '-' %></div>
          </article>

          <article class="card kpi">
            <div class="card__head">
              <span class="muted">Contatos</span>
            </div>
            <div class="kpi__value"><%= (kpis && typeof kpis.total_contacts !== 'undefined') ? kpis.total_contacts : '-' %></div>
          </article>

          <article class="card kpi">
            <div class="card__head">
              <span class="muted">Atendimentos</span>
            </div>
            <div class="kpi__value"><%= (kpis && typeof kpis.total_summaries !== 'undefined') ? kpis.total_summaries : '-' %></div>
          </article>

          <article class="card kpi">
            <div class="card__head">
              <span class="muted">Matrículas</span>
            </div>
            <div class="kpi__value"><%= (kpis && typeof kpis.total_matriculas !== 'undefined') ? kpis.total_matriculas : '-' %></div>
          </article>
        </div>

        <!-- Content split -->
        <div class="grid grid--1">
          <article class="card">
            <div class="card__title">Mensagens recebidas nos últimos 10 dias</div>
            <div class="card__sub">Distribuição diária</div>
            <div class="chart">
              <canvas id="messagesChart" height="258"></canvas>
            </div>
            <div class="legend">
              <span class="legend__item"><span class="dot"></span> Mensagens</span>
            </div>
          </article>
        </div>

        <!-- Table -->
        <article class="card">
          <div class="card__title">Últimos atendimentos</div>
          <div class="table table--responsive">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Assunto</th>
                  <th>Contato</th>
                  <th>Data</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% if (atendimentos && atendimentos.length > 0) { %>
                  <% atendimentos.forEach(a => { %>
                    <tr>
                      <td>#<%= a.id %></td>
                      <td><%= a.assunto %></td>
                      <td><%= a.contato %></td>
                      <td>
                        <%= a.data ? new Date(a.data).toLocaleDateString('pt-BR') : '-' %>
                      </td>
                      <td>
                        <button class="btn btn--xs btn--outline">Ver conversa</button>
                      </td>
                    </tr>
                  <% }) %>
                <% } else { %>
                  <tr>
                    <td colspan="5" class="muted" style="text-align:center;">Nenhum atendimento encontrado</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </article>

     

      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/js/admin/dashboardScripts.js"></script>
</body>
</html>